function getPresetComponent(){return{created:function(){this.$dispatch("content-created",this)},ready:function(){this.$dispatch("content-ready",this)},attached:function(){this.$dispatch("content-attached",this)},detached:function(){this.$dispatch("content-detached",this)},beforeDestroy:function(){this.$dispatch("content-beforeDestroy",this)},afterDestroy:function(){this.$dispatch("content-afterDestroy",this)}}}function getPresetListComponent(t){return{template:Utils.getHTML("assets/js/app/components/"+t+"/template.html"),created:function(){console.log(t,"component.created"),this.resetCondition();var e=window.location.href.match(/\?(.*)/);if(e&&e[1]){var n=Utils.parseQueryString(e[1]);this.assignSearchForm(n)}this.search()||this.fetch(this.$parent.conditions)},beforeDestroy:function(){console.log(t,"component.beforeDestroy"),this.$dispatch("content-beforeDestroy",this),this.notFound(),this.loading(!0)},methods:{fetch:function(e){console.log("fetch",e),this.loading(!0);var n=this,o="http://"+window.location.host+"/api/"+t,s=Utils.buildQueryString(e),a=e.page;window.setTimeout(function(){if($.ajax({url:o+"?"+s,dataType:"json"}).done(function(t){console.log("success",t),n.found(t,a)}).fail(function(t){console.log("failure",t),n.notFound()}),""!=window.location.hash){var t=window.location.href.replace(/\?.*/,"");t+=e?"?"+s:"",console.log("pushStateUrl",window.location.href," => ",t),window.location.href=t}},800)},loading:function(t){this.$parent.isLoading=t},found:function(t,e){console.log("found",t,"page",e),this.$parent.result.list=t.result,this.$parent.result.currentPage=e,this.$parent.result.pages=Utils.calcPagination(e,t.total_count,10,4),this.$parent.result.totalCount=t.total_count,this.$parent.result.totalPage=Math.ceil(t.total_count/10),this.loading(!1)},notFound:function(){console.log("notFound"),this.$parent.result.list=[],this.$parent.result.currentPage=1,this.$parent.result.pages=[],this.$parent.result.totalCount=0,this.$parent.result.totalPage=0,this.$parent.result.currentPage=1,this.loading(!1)},resetCondition:function(){this.$parent.conditions={},this.$parent.conditions.page=1},remove:function(t){console.log("remove",t),confirm("本当に削除しますか？")},page:function(t){console.log("page",t),this.$parent.conditions.page=t,this.fetch(this.$parent.conditions)},prevPage:function(t){if(!$(t.target).closest("li").hasClass("disabled")){var e=this.$parent.result.currentPage-1;this.page(e)}},nextPage:function(t){if(!$(t.target).closest("li").hasClass("disabled")){var e=this.$parent.result.currentPage+1;this.page(e)}},search:function(){var t=$(this.$el).find(".search-form");if(1!==t.size())return!1;var e={},n=t.serializeArray();for(var o in n){var s=n[o],a=s.name.match(/search\[(.+)\]/);a&&a[1]&&(e[a[1]]=s.value)}return 0<e.length&&(this.$parent.conditions.search=e),this.fetch(this.$parent.conditions),!0},assignSearchForm:function(t){for(var e in t){var n=t[e],o=decodeURIComponent(e);$('[name="'+o+'"]').val(n)}}}}}function getPresetCreateComponent(t,e){return{template:Utils.getHTML("assets/js/app/components/"+t+"/template.html"),created:function(){console.log(t,"component.created","getPresetCreateComponent")},beforeDestroy:function(){console.log(t,"component.beforeDestroy"),this.$dispatch("content-beforeDestroy",this),this.loading(!0)},methods:{fetch:function(t){console.log("fetch",t),this.loading(!0)},loading:function(t){this.$parent.isLoading=t},makeRequest:function(t){var e={};return _.forEach(t,function(t,n){console.log("options.sendData",n,t);var o=$('[name="'+t+'"]'),s=null;switch(o.attr("type")){case"text":case"number":s=o.val();break;case"radio":s=o.filter(":checked").val();break;default:s=o.val()}e[n]=s}),e},submit:function(){console.log("submit");var t=this.makeRequest(e.sendData);t.created_by="1",t.updated_by="2",$.ajax({type:"post",url:e.sendTo,dataType:"json",data:t}).done(function(t){console.log("done",t),window.location.href=e.afterDone}).fail(function(t){console.log("fail",t),alert("登録に失敗しました。\n入力内容を確認の上、再度登録してください。")})},assignSearchForm:function(t){for(var e in t){var n=t[e],o=decodeURIComponent(e);console.log("assignSearchForm",o,n),$('[name="'+o+'"]').val(n)}}}}}function mergeComponent(t){return Vue.extend(jQuery.extend(getPresetComponent(),t))}!function(t){t.Utils={getHTML:function(t){var e="";return $.ajax({dataType:"html",url:t,async:!1,success:function(t){e=t}}),e},buildQueryString:function(t,e){var n=[];for(var o in t){var s=e?e+"["+o+"]":o,a=t[o];s&&a&&n.push("object"==typeof a?Utils.buildQueryString(a,s):encodeURIComponent(s)+"="+encodeURIComponent(a))}return n.join("&")},parseQueryString:function(t){var e={},n=t.split("&");for(var o in n){var s=n[o].split("=");console.log(o,s),s[0]&&s[1]&&(e[s[0]]=s[1])}return e},_parseQueryString:function(t){var e={};for(var n in t){var o=t[n].split("=");console.log(n,o),o[0].match(/(.+)\[(.+)\]/)?console.log("_parseQueryString",RegExp.$1,RegExp.$2):e[o[0]]=o[1]}return e},getPages:function(t,e,n){for(var o=[],s=e/n,a=t;s>=a;a++)o.push(a);return o},calcPagination:function(t,e,n,o){var s=Math.ceil(e/n),a=0;o>=t&&(a=o-(t+1));for(var r=t+o+a,i=[],c=t-o;r>=c&&s>=c;c++)1>c||i.push(c);return i}}}(window),Vue.component("questions",getPresetListComponent("questions")),Vue.component("questions-create",mergeComponent({template:Utils.getHTML("assets/js/app/components/questions-create/template.html")})),Vue.component("questions-update",mergeComponent({template:Utils.getHTML("assets/js/app/components/questions-update/template.html")})),Vue.component("operators",getPresetListComponent("operators")),Vue.component("operators-create",mergeComponent({template:Utils.getHTML("assets/js/app/components/operators-create/template.html")})),Vue.component("operators-update",mergeComponent({template:Utils.getHTML("assets/js/app/components/operators-update/template.html")})),Vue.component("informations",getPresetListComponent("informations")),Vue.component("informations-create",getPresetCreateComponent("informations-create",{sendTo:"/api/informations",afterDone:"#/informations",afterFail:null,sendData:{state:"information[state]",content:"information[content]"}})),Vue.component("informations-update",mergeComponent({template:Utils.getHTML("assets/js/app/components/informations-update/template.html")})),Vue.component("responses",getPresetListComponent("responses")),Vue.component("responses-create",mergeComponent({template:Utils.getHTML("assets/js/app/components/responses-create/template.html")})),Vue.component("responses-update",mergeComponent({template:Utils.getHTML("assets/js/app/components/responses-update/template.html")})),Vue.component("tweets",getPresetListComponent("tweets")),Vue.component("pagination",Vue.extend({template:Utils.getHTML("assets/js/app/components/pagination/template.html")})),function(t){"use strict";t.app=new Vue({el:"#app",data:{currentView:"questions",isLoading:!0,conditions:{page:1},result:{totalCount:0,totalPage:0,currentPage:1,list:[],pages:[]}},filters:{formatDate:function(t){return t.substr(0,t.length-3)}},created:function(){var t=this;this.$on("content-created",function(){console.log(t.$data.currentView,"created")})},ready:function(){var t=this;this.$on("content-ready",function(){console.log(t.$data.currentView,"ready")})},attached:function(){var t=this;this.$on("content-attached",function(){console.log(t.$data.currentView,"attached")})},detached:function(){var t=this;this.$on("content-detached",function(){console.log(t.$data.currentView,"detached")})},beforeDestroy:function(){var t=this;this.$on("content-beforeDestroy",function(){console.log(t.$data.currentView,"beforeDestroy")})},afterDestroy:function(){var t=this;this.$on("content-afterDestroy",function(){console.log(t.$data.currentView,"afterDestroy")})},methods:{}})}(window),function(){"use strict";var t={};t["/(questions)?(\\?.*)?"]=function(){app.currentView="questions"},t["/questions/create"]=function(){app.currentView="questions-create"},t["/questions/:id/update"]=function(){app.currentView="questions-update"},t["/questions/:id/delete"]=function(){},t["/responses(\\?.*)?"]=function(){app.currentView="responses"},t["/responses/create"]=function(){app.currentView="responses-create"},t["/responses/:id/update"]=function(){app.currentView="responses-update"},t["/responses/:id/delete"]=function(){},t["/informations(\\?.*)?"]=function(){app.currentView="informations"},t["/informations/create"]=function(){app.currentView="informations-create"},t["/informations/:id/update"]=function(){app.currentView="informations-update"},t["/tweets(\\?.*)?"]=function(){app.currentView="tweets"},t["/operators(\\?.*)?"]=function(){app.currentView="operators"},t["/operators/create"]=function(){app.currentView="operators-create"},t["/operators/:id/update"]=function(){app.currentView="operators-update"};var e=new Router(t);e.init()}(window);